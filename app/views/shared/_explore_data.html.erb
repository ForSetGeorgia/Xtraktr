<div id="explore-data" class="row">
  <% if @questions.present? %>
    <div id="explore-form" class="col-sm-3">
      <h2>
        <%= @dataset.title %>
      </h2>

      <%= form_tag(explore_data_path, :id => 'form-explore-data') do %>

        <div class="row">
          <div class="col-xs-6 col-sm-12">
            <%= label_tag 'question_code', t('.form.question_code') %>
            <select data-live-search="true" data-hide-disabled='true' data-width="100%" class="selectpicker" id="question_code" name="question_code">
              <% @questions.each_with_index do |question, index| %>
                <% 
                  selected = (@question_code.present? && @question_code == question.code) || (@broken_down_by_code.blank? && index == 0) ? 'selected=selected ' : ''
                  disabled = @broken_down_by_code == question.code ? 'disabled=disabled ' : ''
                %>
                <option value="<%= question.code %>" <%= selected %><%= disabled %>><%= "#{question.original_code} - #{question.text}" %></option>
              <% end %>
            </select>
          </div>

          <div class="col-xs-6 col-sm-12">
            <div id="var2-label-swap" class="clear">
              <%= label_tag 'broken_down_by_code', "#{t('.form.broken_down_by_code')} (#{t('.form.optional')})" %>
              <% 
                display = 'style=display:none;'
                display = '' if @broken_down_by_code.present? 
              %>
              <button id="btn-swap-vars" type="button" class="btn btn-default btn-xs" title="<%= t('.form.swap') %>" <%= display %>>
                <span class="glyphicon glyphicon-refresh"></span>
              </button>        
            </div>
            <select data-live-search="true" data-hide-disabled='true' data-width="100%" class="selectpicker" id="broken_down_by_code" name="broken_down_by_code">
              <% 
                selected = @broken_down_by_code.blank? ? 'selected=selected' : '' %>
              %>
              <option value="" <%= selected %>><%= t('.form.no_comparison') %></option>
              <% @questions.each_with_index do |question, index| %>
                <% 
                  selected = @broken_down_by_code.present? && @broken_down_by_code == question.code ? 'selected=selected ' : ''
                  disabled = @question_code == question.code ? 'disabled=disabled ' : ''
                %>
                <option value="<%= question.code %>" <%= selected %><%= disabled %>><%= "#{question.original_code} - #{question.text}" %></option>
              <% end %>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col-xs-6 col-sm-12">
            <%= label_tag 'filtered_by_code', t('.form.filtered_by_code') %>
            <select data-live-search="true" data-hide-disabled='true' data-width="100%" class="selectpicker-filter" id="filtered_by_code" name="filtered_by_code">
              <option value=""><%= t('.form.no_filter') %></option>
              <% @questions.each do |question| %>
                <% 
                  selected = @filtered_by_code == question.code ? 'selected=selected ' : ''
                  disabled = @broken_down_by_code == question.code || @question_code == question.code ? 'disabled=disabled ' : ''
                %>
                <option value="<%= question.code %>" <%= selected %><%= disabled %>><%= "#{question.original_code} - #{question.text}" %></option>
              <% end %>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col-xs-6 col-sm-12">
            <%= label_tag 'can_exclude', :id => 'lbl_can_exclude', :title => t('.form.can_exclude_hint') do %>
              <%= check_box_tag 'can_exclude', true, params[:can_exclude].present? ? params[:can_exclude].to_bool : false %>
              <%= t('.form.can_exclude') %>
            <% end %>
          </div>
          <div class="col-xs-3 col-xs-offset-3 col-sm-12 col-sm-offset-0 clear" id="buttons">
            <%= submit_tag t('.form.reset'), :class => 'btn', :id => 'btn-reset' %>
            <%= submit_tag t('.form.submit'), :class => 'btn', :id => 'btn-submit' %>
          </div>
        </div>
      <% end %> 

      <div id="jumpto">
        <div id='jumpto-chart'>
          <h3><%= t('.jumpto.chart') %></h3>
          <select data-live-search="true" data-width="100%" class="selectpicker"></select>
        </div>

        <div id='jumpto-map'>
          <h3><%= t('.jumpto.map') %></h3>
          <div class='jumpto-map-item'>
            <h4></h4>
            <select data-live-search="true" data-width="100%" class="selectpicker"></select>
          </div>
      </div>

<!--         <h3><%= t('.jumpto.header') %></h3>
        <ul class="list-unstyled" id="jumpto-charts">
          <li id="jumpto-charts-items" data-href="#container-chart">
            <%= t('.jumpto.charts') %>
            <ul class="jumpto-items">
            </ul>
          </li>
        </ul>
        <ul class="list-unstyled" id="jumpto-maps">
          <li id="jumpto-maps-items" data-href="#container-map">
            <%= t('.jumpto.maps') %>
            <ul class="jumpto-items">
            </ul>
          </li>
        </ul>
 -->        
        <div id="jumpto-loader"></div>
      </div>

    </div>

    <div id="explore-data-content" class="col-sm-9">
      <ul class="nav nav-tabs" id="explore-tabs" role="tablist">
        <li id="nav-chart"><a href="#tab-chart" role="tab" data-toggle="tab"><%= t('.tabs.chart') %></a></li>
        <li id="nav-map" style="display:none;"><a href="#tab-map" role="tab" data-toggle="tab"><%= t('.tabs.map') %></a></li>
        <li id="nav-table"><a href="#tab-table" role="tab" data-toggle="tab"><%= t('.tabs.table') %></a></li>
        <li id="nav-details"><a href="#tab-details" role="tab" data-toggle="tab"><%= t('.tabs.details') %></a></li>
      </ul>      

      <div class="tab-content" id="explore-content">

        <%-
          data_attr = ''
          if @is_dataset_admin
            data_attr = "data-add-highlight=#{add_highlight_dataset_path(id: @dataset.id)} data-delete-highlight=#{remove_highlight_dataset_path(id: @dataset.id)}"
          end
        -%>
        
        <div class="tab-pane fade" id="tab-chart">
          <div id="container-chart" <%= data_attr %> ></div>
        </div>


        <div class="tab-pane active" id="tab-map">
          <div id="container-map" <%= data_attr %> ></div>
        </div>


        <div class="tab-pane fade" id="tab-table">
          <div id="container-table">
            <h3></h3>
            <table class="table-data table table-striped table-hover table-nonfluid" 
                  data-count="<%= t('app.common.count') %>" data-percent="<%= t('app.common.percent') %>">
            </table>
          </div>
        </div>


        <div class="tab-pane fade" id="tab-details">
          <div class="details-item" id="details-question-code">
            <h3><%= t('.form.question_code') %></h3>
            <p>
              <span class="header-variable"><%= t('app.common.question') %>:</span>
              <span class="name-variable"></span>
            </p>
            <p>
              <span class="header-code"><%= t('app.common.question_code') %>:</span>
              <span class="name-code"></span>
            </p>
            <p class="details-notes">
              <span class="header-notes"><%= t('app.common.notes') %>:</span>
              <span class="notes"></span>
            </p>
            <p>
              <span class="header-answers"><%= t('app.common.answers') %></span>
            </p>
            <ul class="list-answers">
            </ul> 
          </div>
          <div class="details-item" id="details-broken-down-by-code">
            <h3><%= t('.form.broken_by_code') %></h3>
            <p>
              <span class="header-variable"><%= t('app.common.question') %>:</span>
              <span class="name-variable"></span>
            </p>
            <p>
              <span class="header-code"><%= t('app.common.question_code') %>:</span>
              <span class="name-code"></span>
            </p>
            <p class="details-notes">
              <span class="header-notes"><%= t('app.common.notes') %>:</span>
              <span class="notes"></span>
            </p>
            <p>
              <span class="header-answers"><%= t('app.common.answers') %></span>
            </p>
            <ul class="list-answers">
            </ul> 
          </div>
          <div class="details-item" id="details-filtered-by-code">
            <h3><%= t('.form.filtered_by_code') %></h3>
            <p>
              <span class="header-variable"><%= t('app.common.question') %>:</span>
              <span class="name-variable"></span>
            </p>
            <p>
              <span class="header-code"><%= t('app.common.question_code') %>:</span>
              <span class="name-code"></span>
            </p>
            <p class="details-notes">
              <span class="header-notes"><%= t('app.common.notes') %>:</span>
              <span class="notes"></span>
            </p>
            <p>
              <span class="header-answers"><%= t('app.common.answers') %></span>
            </p>
            <ul class="list-answers">
            </ul> 
          </div>
        </div>

      </div>

      <div id="explore-data-loader">
        <div class="spinner">
          <div class="rect1"></div>
          <div class="rect2"></div>
          <div class="rect3"></div>
          <div class="rect4"></div>
          <div class="rect5"></div>
        </div>      
      </div>

      <div id="explore-error">
        <p>
          <%= t('app.msgs.explore_error') %>
        </p>
      </div>


    </div>

  <% else %>

    <p>
      <%= t('.no_data', title: @dataset.title) %>
    </p>

  <% end %>
</div>