<div id="explore-time-series" class="row">
  <% if @questions.present? %>
    <div class="col-sm-3">

      <%= form_tag(explore_time_series_path, :id => 'form-explore-time-series') do %>

        <%
          filter_variable = @filter.present? ? @filter[:code] : ''
        %>

        <div class="row">
          <div class="col-xs-6 col-sm-12">
            <%= label_tag 'question_code', t('.form.question_code') %>
            <select data-live-search="true" data-hide-disabled='true' data-width="100%" class="selectpicker" id="question_code" name="question_code">
              <% @questions.each_with_index do |question, index| %>
                <% 
                  selected = (@question_code.present? && @question_code == question.code) ? 'selected=selected ' : ''
                %>
                <option value="<%= question.code %>" <%= selected %> ><%= "#{question.original_code} - #{question.text}" %></option>
              <% end %>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col-xs-6 col-sm-12">
            <%= label_tag 'filtered_by_code', t('.form.filtered_by_code') %>
            <select data-live-search="true" data-hide-disabled='true' data-width="100%" class="selectpicker-filter" id="filtered_by_code" name="filtered_by_code">
              <option value=""><%= t('.form.no_filter') %></option>
              <% @questions.each do |question| %>
                <% 
                  selected = @filtered_by_code == question.code ? 'selected=selected ' : ''
                  disabled = @question_code == question.code ? 'disabled=disabled ' : ''
                %>
                <option value="<%= question.code %>" <%= selected %><%= disabled %>><%= "#{question.original_code} - #{question.text}" %></option>
              <% end %>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col-xs-6 col-sm-12">
            <%= label_tag 'can_exclude', :id => 'lbl_can_exclude', :title => t('.form.can_exclude_hint') do %>
              <%= check_box_tag 'can_exclude', true, params[:can_exclude].present? ? params[:can_exclude].to_bool : false %>
              <%= t('.form.can_exclude') %>
            <% end %>
          </div>
          <div class="col-xs-3 col-xs-offset-3 col-sm-12 col-sm-offset-0 text-right">
            <%= submit_tag t('.form.reset'), :class => 'btn btn-warning', :id => 'btn-reset' %>
            <%= submit_tag t('.form.submit'), :class => 'btn btn-primary', :id => 'btn-submit' %>
          </div>
        </div>
      <% end %> 

      <div class="panel-group" id="panel-instructions" style="margin-top: 20px;">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#panel-instructions" href="#instructions">
                <%= t('.instructions.header') %>
              </a>
            </h4>
          </div>
          <div id="instructions" class="panel-collapse collapse">
            <div class="panel-body">
              <p>
                <%= t('.instructions.p1a') %>
                <%= t('.instructions.p1b') %>
              </p>
            </div>
          </div>
        </div>
      </div>

      
    </div>

    <div id="explore-time-series-content" class="col-sm-9">
      <ul class="nav nav-tabs" id="explore-tabs" role="tablist">
        <li id="nav-chart"><a href="#tab-chart" role="tab" data-toggle="tab"><%= t('.tabs.chart') %></a></li>
        <li id="nav-details"><a href="#tab-details" role="tab" data-toggle="tab"><%= t('.tabs.details') %></a></li>
      </ul>      

      <div class="tab-content" id="explore-content">

        <div class="tab-pane" id="tab-chart">
          <div id="chart"></div>

          <div class="container-table">
            <h2><span><%= t('.tabs.table') %></span></h2>

            <h3></h3>
            <table class="table-data table table-striped table-hover table-nonfluid" 
                  data-count="<%= t('.table.count') %>" data-percent="<%= t('.table.percent') %>">
            </table>
          </div>
        </div>

        <div class="tab-pane" id="tab-details">
          <div class="row">
            <div class="col-sm-12" id="details-question-code">
              <p>
                <strong><%= t('.details.variable') %>:</strong>
                <span id="details-question-code-question"></span>
              </p>
              <p>
                <strong><%= t('.details.answers') %></strong>
              </p>
              <ul id="details-question-code-answers">
              </ul> 
            </div>
          </div>
        </div>
      </div>

      <div id="explore-time-series-loader">
        <div class="spinner">
          <div class="rect1"></div>
          <div class="rect2"></div>
          <div class="rect3"></div>
          <div class="rect4"></div>
          <div class="rect5"></div>
        </div>      
      </div>
    </div>

  <% else %>

    <p>
      <%= t('.no_data', title: @time_series.title) %>
    </p>

  <% end %>
</div>