<%- model_class = Dataset -%>

<% title t('.title') %>

<% if @datasets.present? %>
  <ul class="list-unstyled">
    <% @datasets.each do |dataset| %>
      <li>
        <h2><%= link_to dataset.title, explore_data_dashboard_path(dataset) %></h2>
        <div class="row">
          <div class="col-sm-4" id="meta-dates">
            <%= model_class.human_attribute_name(:gathered_at) %>:
            <%= format_gathered_dates(dataset.start_gathered_at, dataset.end_gathered_at) %>
          </div>
          <div class="col-sm-4" id="meta-dates">
            <%= model_class.human_attribute_name(:released_at) %>:
            <%= I18n.l(dataset.released_at, format: :day_first) if dataset.released_at.present? %>
          </div>
          <% if dataset.time_series_datasets.present? %>
            <div class="col-sm-2" id="time-series-link">
              <%= link_to t('app.menu.time_series'), explore_time_series_dashboard_path(dataset.time_series_datasets.first.time_series_id), class: 'btn btn-primary btn-sm', title: t('app.menu.titles.dataset_to_time_series') %>
            </div>
          <% end %>
          <% if dataset.urls.present? %>
            <div class="col-sm-2" id="download-links">
              <div id="data-download-list" class="dropdown">
                <button id="data-download-label" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <%= t('helpers.links.download_data') %>
                  <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu" aria-labelledby="data-download-label">
                  <li><%= link_to t('download_data_options.text.csv'), dataset.urls.csv, title: t('download_data_options.title.csv'), 
                          :'data-id' => dataset.id.to_s, :'data-file-type' => 'csv' %></li>
                  <li><%= link_to t('download_data_options.text.r'), dataset.urls.r, title: t('download_data_options.title.r'), 
                          :'data-id' => dataset.id.to_s, :'data-file-type' => 'r' %></li>
                  <li><%= link_to t('download_data_options.text.spss'), dataset.urls.spss, title: t('download_data_options.title.spss'), 
                          :'data-id' => dataset.id.to_s, :'data-file-type' => 'spss' %></li>
                  <li><%= link_to t('download_data_options.text.stata'), dataset.urls.stata, title: t('download_data_options.title.stata'), 
                          :'data-id' => dataset.id.to_s, :'data-file-type' => 'stata' %></li>
                </ul>
              </div>          
            </div>
          <% end %>
        </div>
        <% if @is_xtraktr %>
        <div>
          <%= "#{model_class.human_attribute_name(:source)}: #{dataset.source}" %>
        </div>
        <% end %>
        <% if dataset.description.present? %>
          <div class="tinymce_format">
            <%= simple_format_no_tags(dataset.description, {}, {sanitize: false}) %>
          </div>
        <% end %>
      </li>
    <% end %>
  </ul>
<% else %>
  <p>
    <%= t('.no_data') %>
  </p>
<% end %>